# Перевернутий маятник і LQR: Посібник для початківців
## Мистецтво балансування хаосу

---

## **Проблема: Виклик з мітлою**

Спробуйте утримати мітлу вертикально на долоні.
- Якщо вона нахиляється трохи **вліво**, ви повинні рухати руку **вліво** (і швидко!), щоб опинитися під нею.
- Якщо ви рухаєтесь занадто повільно, вона впаде.
- Якщо ви рухаєтесь занадто швидко, ви відкинете її в інший бік.

Це **Нестабільна Система**.
- **Стабільна Система:** М'яч у чаші. Якщо штовхнути, він повернеться.
- **Нестабільна Система:** М'яч на пагорбі. Якщо штовхнути, він зник.

Щоб тримати мітлу вгорі, вам потрібне **Активне Керування** кожну мілісекунду.

---

## **Стратегія керування: LQR**

PID чудовий для простих речей (як утримання швидкості).
Але балансування мітли включає:
1.  **Позицію візка** (Залишатися в кімнаті)
2.  **Швидкість візка** (Не розбитися)
3.  **Кут маятника** (Не впасти)
4.  **Кутову швидкість маятника** (Не обертатися)

PID важко жонглювати 4 речами одночасно.
Входить **LQR (Лінійно-Квадратичний Регулятор)**.

### **Як працює LQR**
Він використовує математичну "Функцію Витрат" (J), щоб вирішити ідеальний хід.
Він балансує два жадібних бажання:
1.  **Вартість Стану (Q):** "Я хочу, щоб помилка була НУЛЬОВОЮ."
2.  **Вартість Керування (R):** "Я хочу бути ЛІНИВИМ (економити енергію)."

> **Аналогія:**
> LQR як ледачий геній. Він розраховує *точний мінімальний зусиль*, необхідний для утримання мітли вертикально, не бігаючи 100 миль/год.

---

## **Як користуватися симулятором**

### **1. Фізика**
- **Маса візка (M):** Важкий візок = Важче розігнати.
- **Довжина маятника (l):** Довга палиця = Падає повільніше (Легше). Коротка палиця = Падає миттєво (Важче).

### **2. Налаштування LQR (Q та R)**
- **Q_pos (x):** Наскільки вам важливо залишатися в центрі?
    - Високе Q_pos = Буде мчати назад до центру (агресивно).
- **Q_angle (theta):** Наскільки вам важливо бути вертикальним?
    - **КРИТИЧНО.** Має бути високим, інакше впаде.
- **R (Вартість Керування):** Наскільки дороге паливо?
    - Високе R = Плавні, ніжні рухи.
    - Низьке R = Ривкові, різкі рухи.

### **3. Експерименти**
1.  **"Лінивий" Контролер:** Встановіть **R = 10**. Він рухатиметься занадто повільно, і маятник впаде.
2.  **"Нервовий" Контролер:** Встановіть **R = 0.01**. Він буде шалено вібрувати, щоб залишатися ідеально вертикальним.
3.  **Збурення:** Натисніть **"Add Disturbance"**. Це штовхне візок. Дивіться, як LQR бореться за відновлення.

---

## **Ключові моменти для інтерв'ю**

| Поняття | Пояснення |
|---|---|
| **LQR** | Оптимальний метод керування для багатоваріантних (MIMO) систем. |
| **Простір станів** | Представлення системи як вектора чисел (x, dx, theta, dtheta). |
| **Полюси** | У теорії керування "Нестабільні Полюси" означають, що система вибухає. LQR переміщує ці полюси в стабільну область. |
| **Функція Витрат** | Математична формула, яку мінімізує LQR: `Сума(Помилка^2 + Зусилля^2)`. |

> **Реальний світ:** Ракети, що балансують під час зльоту, використовують цю логіку. Сегвеї використовують цю логіку.

---

## **Чому це важко?**
Тому що система **Нелінійна**.
LQR припускає, що світ лінійний (простий).
- Якщо кут стає занадто великим (> 20 градусів), лінійне припущення не працює, і LQR **здається**.
- Спробуйте встановити `Initial Angle` на 45 градусів. Дивіться, як він падає.

**Це межа Лінійного Керування.**
